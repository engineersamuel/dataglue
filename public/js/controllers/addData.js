// Generated by CoffeeScript 1.6.2
(function() {
  define(['underscore'], function(_) {
    return [
      '$scope', '$location', '$routeParams', 'dbService', function($scope, $location, $routeParams, dbService) {
        $scope.welcomeMessage = 'Add Data';
        if ($routeParams['_id'] != null) {
          dbService.cacheGet($routeParams['_id'], function(data) {
            return console.log("Read cached dataSet: " + (JSON.stringify(data._id)));
          });
        }
        $scope.connection = void 0;
        $scope.schema = void 0;
        $scope.table = void 0;
        $scope.connections = void 0;
        $scope.schemas = void 0;
        $scope.tables = void 0;
        if (!$scope.connection) {
          dbService.getConnections('/db/info', function(data) {
            return $scope.connections = data;
          });
        }
        $scope.select_connection = function(connection) {
          $scope.connection = connection;
          $scope.schemas = [];
          $scope.tables = [];
          return dbService.getSchemas($scope.connection, function(data) {
            return $scope.schemas = data;
          });
        };
        $scope.select_schema = function(schema) {
          $scope.schema = schema;
          $scope.tables = [];
          return dbService.getTables($scope.connection, $scope.schema, function(data) {
            return $scope.tables = data;
          });
        };
        $scope.select_table = function(table) {
          $scope.table = table;
          $scope.fields = [];
          return dbService.getFields($scope.connection, $scope.schema, $scope.table, function(data) {
            var key;

            dbService.fields = data;
            $scope.fields = data;
            key = [$scope.connection, $scope.schema, $scope.table].join('\u2980');
            if (!_.has(dbService.dataSet.dbReferences, key)) {
              dbService.dataSet.dbReferences[key] = {
                key: key,
                connection: $scope.connection,
                schema: $scope.schema,
                table: $scope.table,
                fields: $scope.fields
              };
            }
            return dbService.cacheUpsert(function(data) {
              return $location.path("/Graph/" + data['_id']);
            });
          });
        };
        return $scope.$apply();
      }
    ];
  });

}).call(this);

/*
//@ sourceMappingURL=addData.map
*/
